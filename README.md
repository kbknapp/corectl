# corectl

Bootstrapping and management of CoreOS clusters.

## Usage

### Creating a new repo

corectl needs a repository with a few special files in order to operate. To create one, run the following command:

```
$ corectl new PATH
```

This will create a new directory at the given path with the following structure:

```
.
|-- build
|-- units
|-- .gitignore
|-- config.yml
|-- README.md
```

Additional corectl commands should be run inside this project directory.

The `build` directory is ignored by Git. This is where files generated by corectl live. The `units` directory is for you to use to store systemd/fleet unit files. `config.yml` is the configuration file where your cluster is defined. `README.md` is a simple README explaining what the repository is, for future reference.

### Launch a cluster in Vagrant

Once you've configured the cluster to your liking (see [Configuration](#configuration) below), launch the cluster using Vagrant:

```
$ corectl vagrant up
```

Once all the VMs are booted, you can connect to a VM with:

```
$ corectl vagrant ssh VM_NAME
```

When you're done, destroy the cluster:

```
$ corectl vagrant destroy
```

### Launch a cluster in the cloud

Launching a cluster on a real cloud service works similarly to the Vagrant cluster. Launch a new cluster by running:

```
$ corectl up
```

This will launch the cluster according to the configuration defined in `config.yml`.

Connecting to one of the nodes and destroying the cluster works similarly:

```
$ corectl ssh NODE_NAME
$ corectl destroy
```

### Deploying a fleet unit

To deploy a systemd unit to your cluster with fleet, use the `corectl fleet` commands. They are analogous to the normal `fleetctl` commands, but automatically send them to your corectl cluster:

```
$ corectl fleet cat
$ corectl fleet destroy
$ corectl fleet journal
$ corectl fleet list-machines
$ corectl fleet list-unit-files
$ corectl fleet list-units
$ corectl fleet load
$ corectl fleet start
$ corectl fleet status
$ corectl fleet stop
$ corectl fleet submit
$ corectl fleet unload
```

## Configuration

Your corectl cluster is configured with the `config.yml` file, which uses the [YAML](http://www.yaml.org/) data serialization format. Here is an example:

``` yaml
---
clusters:
  - name: core
    provider: aws
    provider_options:
      region: us-east-1
      aws_access_key_id: !ENV:AWS_ACCESS_KEY_ID
      aws_secret_access_key: !ENV:AWS_SECRET_ACCESS_KEY
    vagrant:
      provider: virtualbox
    cloud_config:
      coreos:
        fleet:
          metadata: platform=ec2,region=us-east-1
        update:
          group: stable
      ssh_authorized_keys:
        - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC0g+ZTxC7weoIJLUafOgrm+h...
    node:
      - cloud_config:
          merge:
            coreos:
              fleet:
                metadata: role=balancer
      - cloud_config:
          merge:
            coreos:
              fleet:
                metadata: role=db
      - cloud_config:
          merge:
            coreos:
              fleet:
                metadata: role=app
          override:
            coreos:
              update:
                group: beta
```

### Configuration structure

_TODO_

## License

[MIT](http://opensource.org/licenses/MIT)
